@{
    ViewBag.PageName = "Home";
}
@model IEnumerable<TachLayout.Models.SanPham>

<div id="templatemo_main_wrapper">
        <div id="templatemo_main">
          <div id="sidebar" class="left">
            <div class="sidebar_box">
              <span class="bottom"></span>
              <h3>Categories</h3>
              <div class="content">
                <ul class="sidebar_list">
                  <li><a href="#">Nulla odio ipsum</a></li>
                  <li><a href="#">Suspendisse posuere</a></li>
                  <li><a href="#">Aliquam euismod</a></li>
                  <li><a href="#">Curabitur ac mauris</a></li>
                  <li><a href="#">Mauris nulla tortor</a></li>
                  <li><a href="#">Nullam ultrices</a></li>
                  <li><a href="#">Vivamus scelerisque</a></li>
                  <li><a href="#">Suspendisse posuere</a></li>
                  <li><a href="#">Quisque vel justo</a></li>
                </ul>
              </div>
            </div>
            <div class="sidebar_box">
              <span class="bottom"></span>
              <h3>Weekly Special</h3>
              <div class="content special">
                <img src="images/templatemo_image_01.jpg" alt="Flowers" />
                <a href="#">Citrus Burst Bouquet</a>
                <p>
                  Price:
                  <span class="price normal_price">$160</span>&nbsp;&nbsp;
                  <span class="price special_price">$100</span>
                </p>
              </div>
            </div>
          </div>

          <div id="content" class="right">
            <h2>Welcome to Floral Shop</h2>
            <p>
              Floral Shop is free website template by templatemo. Sed in
              suscipit risus, eget consectetur justo. Praesent lacinia, nisi
              quis commodo consectetur, diam magna laoreet felis, a pulvinar
              mauris enim in felis. Phasellus in mauris velit. In pellentesque
              massa in nisl auctor pellentesque. Donec fermentum convallis
              purus, id luctus nulla tempus in. Aliquam diam nibh, consectetur
              quis fringilla facilisis, egestas sed odio. Validate
              <a href="http://validator.w3.org/check?uri=referer" rel="nofollow"
                ><strong>XHTML</strong></a
              >
              &amp;
              <a
                href="http://jigsaw.w3.org/css-validator/check/referer"
                rel="nofollow"
                ><strong>CSS</strong></a
              >.
            </p>
            @* Hiển thị danh sách sản phẩm *@
            @if (Model != null && Model.Any())
            {
                int productCount = 0;

                foreach (var item in Model)
                {
                    // Xử lý hình ảnh
                    string imagePath = "~/images/product/default.jpg";
                    if (!string.IsNullOrEmpty(item.Hinh))
                    {
                        if (item.Hinh.StartsWith("/images/") || item.Hinh.StartsWith("~"))
                        {
                            imagePath = item.Hinh;
                        }
                        else
                        {
                            imagePath = "~/images/product/" + item.Hinh;
                        }
                    }

                    // Giá hiển thị: nếu có khuyến mãi thì ưu tiên
                    decimal giaHienThi = (item.GiaKm != null && item.GiaKm > 0) ? item.GiaKm.Value : item.Gia;

                    <div class="product_box @(productCount % 4 == 3 ? "no_margin_right" : "")">
                        <a href="@Url.Action("Details", "Product", new { id = item.MaSp })">
                            <img src="@Url.Content(imagePath)" width="165" height="165"
                                 alt="@item.TenSp"
                                 onerror="this.onerror=null;this.src='@Url.Content("~/images/product/default.jpg")';" />
                        </a>
                        <h3>@item.TenSp</h3>
                        <p class="product_price">@String.Format("{0:N0} đồng", giaHienThi)</p>
                        <p class="add_to_cart">
                            <a href="@Url.Action("Details", "Product", new { id = item.MaSp })">Detail</a>
                            <a href="@Url.Action("AddToCart", "ShoppingCart", new { id = item.MaSp })">Add to Cart</a>
                        </p>
                    </div>

                    productCount++;
                    if (productCount % 4 == 0)
                    {
                        <div class="cleaner"></div>
                    }
                }
            }
            else
            {
                <p>Không có sản phẩm nào để hiển thị.</p>
            }

            <div class="blank_box">
              <a href="#"
                ><img src="images/free_shipping.jpg" alt="Free Shipping"
              /></a>
            </div>
          </div>
          <div class="cleaner"></div>
        </div>
        <!-- END of main -->
      </div>